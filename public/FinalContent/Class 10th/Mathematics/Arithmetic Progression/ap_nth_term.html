<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finding nth Term of AP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(79, 172, 254, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 75% 75%, rgba(168, 85, 247, 0.06) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(79, 172, 254, 0.2);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #a855f7 0%, #3b82f6 30%, #06b6d4 60%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.2rem;
            color: #cbd5e1;
            margin: 0 auto;
        }

        /* Main Animation Stage */
        .animation-stage {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            height: 550px;
            position: relative;
            margin: 30px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Content Scenes */
        .content-scene {
            display: none;
            opacity: 0;
            padding: 20px;
            text-align: center;
            width: 100%;
            height: 100%;
            transition: opacity 0.8s ease;
            position: absolute;
            top: 0;
            left: 0;
        }

        .content-scene.visible {
            display: flex;
            opacity: 1;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .scene-title {
            font-size: 2.2rem;
            color: #3b82f6;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .scene-content {
            max-width: 900px;
            width: 100%;
        }

        /* Step containers */
        .step-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .step-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .step-title {
            font-size: 1.4rem;
            color: #10b981;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .step-description {
            color: #e2e8f0;
            line-height: 1.6;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        /* Formula displays */
        .formula-display {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.4rem;
            color: #06b6d4;
            text-align: center;
        }

        .formula-derivation {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            color: #a855f7;
        }

        .derivation-step {
            margin: 10px 0;
            font-size: 1.2rem;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s ease;
        }

        .derivation-step.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* Example boxes */
        .example-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .example-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 20px;
            color: #10b981;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s ease;
        }

        .example-box.visible {
            opacity: 1;
            transform: scale(1);
        }

        .example-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fbbf24;
        }

        .example-problem {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #e2e8f0;
        }

        .example-solution {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
            color: #10b981;
        }

        /* Interactive solver */
        .solver-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin: 15px 0;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            color: white;
            font-size: 1rem;
        }

        .solve-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            margin: 15px auto;
            display: block;
        }

        .solve-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .result-display {
            margin-top: 15px;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            display: none;
            text-align: center;
        }

        .result-display.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #10b981;
        }

        .result-display.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
        }

        /* Salary progression visualization */
        .salary-progression {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .salary-year {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 15px;
            flex: 1;
            min-width: 120px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .salary-year.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .year-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .salary-amount {
            font-size: 1.2rem;
            color: #3b82f6;
            font-weight: 600;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 30px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 160px;
        }

        .demo-btn:hover {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            transform: translateY(-2px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }

        .analysis-title {
            font-size: 1.4rem;
            color: #3b82f6;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #e2e8f0;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .animation-stage {
                height: 450px;
            }
            
            .content-scene {
                padding: 15px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .example-container,
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .salary-progression {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Finding nth Term of AP</h1>
            <p>Master the formula derivation and solve real-world problems</p>
        </div>

        <!-- Main Animation Stage -->
        <div class="animation-stage">
            
            <!-- Welcome Scene -->
            <div class="content-scene visible" id="welcome-scene">
                <div class="scene-title">nth Term Formula</div>
                <div class="scene-content">
                    <p style="font-size: 1.3rem; color: #cbd5e1; line-height: 1.6;">
                        Learn to find any term in an arithmetic progression using the powerful nth term formula.
                        We'll derive the formula step-by-step and apply it to real problems.
                    </p>
                    <div class="formula-display" style="margin-top: 30px;">
                        aₙ = a + (n-1)d
                    </div>
                </div>
            </div>

            <!-- Derivation Scene -->
            <div class="content-scene" id="derivation-scene">
                <div class="scene-title">Formula Derivation</div>
                <div class="scene-content">
                    <div class="step-container">
                        <div class="step-title">Step-by-Step Development</div>
                        <div class="step-description">
                            Let's derive the nth term formula using Reena's salary progression:
                        </div>
                        
                        <div class="salary-progression" id="salary-demo">
                            <div class="salary-year">
                                <div class="year-label">Year 1</div>
                                <div class="salary-amount">₹8,000</div>
                            </div>
                            <div class="salary-year">
                                <div class="year-label">Year 2</div>
                                <div class="salary-amount">₹8,500</div>
                            </div>
                            <div class="salary-year">
                                <div class="year-label">Year 3</div>
                                <div class="salary-amount">₹9,000</div>
                            </div>
                            <div class="salary-year">
                                <div class="year-label">Year 4</div>
                                <div class="salary-amount">₹9,500</div>
                            </div>
                        </div>
                        
                        <div class="formula-derivation" id="derivation-steps">
                            <div class="derivation-step">1st term: a₁ = a = 8000</div>
                            <div class="derivation-step">2nd term: a₂ = a + d = 8000 + 500</div>
                            <div class="derivation-step">3rd term: a₃ = a + 2d = 8000 + 2×500</div>
                            <div class="derivation-step">4th term: a₄ = a + 3d = 8000 + 3×500</div>
                            <div class="derivation-step">Pattern: aₙ = a + (n-1)d</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Examples Scene -->
            <div class="content-scene" id="examples-scene">
                <div class="scene-title">Worked Examples</div>
                <div class="scene-content">
                    <div class="example-container" id="examples-grid">
                        <div class="example-box">
                            <div class="example-title">Example 1: Find 10th term</div>
                            <div class="example-problem">AP: 2, 7, 12, ...</div>
                            <div class="example-solution">
                                Given: a = 2, d = 5, n = 10<br>
                                a₁₀ = 2 + (10-1)×5<br>
                                a₁₀ = 2 + 9×5 = 47
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Example 2: Find which term</div>
                            <div class="example-problem">AP: 21, 18, 15, ... which term is -81?</div>
                            <div class="example-solution">
                                Given: a = 21, d = -3, aₙ = -81<br>
                                -81 = 21 + (n-1)(-3)<br>
                                -81 = 21 - 3n + 3<br>
                                n = 35
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Example 3: Check if term exists</div>
                            <div class="example-problem">Is 301 a term of 5, 11, 17, 23, ...?</div>
                            <div class="example-solution">
                                Given: a = 5, d = 6, aₙ = 301<br>
                                301 = 5 + (n-1)×6<br>
                                n = 296/6 = 49.33...<br>
                                Not integer → 301 is NOT a term
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Solver Scene -->
            <div class="content-scene" id="solver-scene">
                <div class="scene-title">Interactive Solver</div>
                <div class="scene-content">
                    <div class="solver-container">
                        <div class="step-title">Find nth Term or Position</div>
                        <div class="step-description">
                            Enter the known values to solve for the unknown:
                        </div>
                        
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">First term (a)</label>
                                <input type="number" class="input-field" id="input-a" placeholder="e.g., 3">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Common difference (d)</label>
                                <input type="number" class="input-field" id="input-d" placeholder="e.g., 5">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Term position (n)</label>
                                <input type="number" class="input-field" id="input-n" placeholder="Leave blank to find">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Term value (aₙ)</label>
                                <input type="number" class="input-field" id="input-an" placeholder="Leave blank to find">
                            </div>
                        </div>
                        
                        <button class="solve-btn" onclick="solveNthTerm()">Solve</button>
                        
                        <div id="solver-result" class="result-display"></div>
                    </div>
                </div>
            </div>

            <!-- Applications Scene -->
            <div class="content-scene" id="applications-scene">
                <div class="scene-title">Real-World Applications</div>
                <div class="scene-content">
                    <div class="example-container" id="applications-grid">
                        <div class="example-box">
                            <div class="example-title">Finding Large Terms</div>
                            <div class="example-problem">100th term of 3, 8, 13, 18, ...</div>
                            <div class="example-solution">
                                a = 3, d = 5<br>
                                a₁₀₀ = 3 + (100-1)×5<br>
                                a₁₀₀ = 3 + 495 = 498
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Two-digit numbers ÷ 3</div>
                            <div class="example-problem">How many: 12, 15, 18, ..., 99?</div>
                            <div class="example-solution">
                                a = 12, d = 3, last = 99<br>
                                99 = 12 + (n-1)×3<br>
                                n = 30 terms
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Terms from End</div>
                            <div class="example-problem">5th term from end in 10, 7, 4, ..., -62</div>
                            <div class="example-solution">
                                Total terms: n = 25<br>
                                5th from end = 21st term<br>
                                a₂₁ = 10 + (21-1)×(-3) = -50
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title">Explore nth Term Concepts</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="showScene('derivation-scene', 0)">Formula Derivation</button>
                <button class="demo-btn" onclick="showScene('examples-scene', 1)">Worked Examples</button>
                <button class="demo-btn" onclick="showScene('solver-scene', 2)">Interactive Solver</button>
                <button class="demo-btn" onclick="showScene('applications-scene', 3)">Applications</button>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis">
            <div class="analysis-title">Learning Progress</div>
            <div class="analysis-content" id="analysis-content">
                Master the nth term formula through step-by-step derivation, worked examples, and real-world applications.
                Use the interactive solver to practice and verify your understanding.
            </div>
        </div>
    </div>

    <script>
        // Voice System
        class NthTermNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.8 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
            }
        }

        // Global state
        let globalAudioEnabled = true;
        let currentNarrator = null;
        let isAnimating = false;

        const sceneNarrations = {
            'welcome-scene': 'Welcome to finding the nth term of arithmetic progressions! The nth term formula a-n equals a plus n minus 1 times d is one of the most powerful tools in mathematics.',
            'derivation-scene': 'Let\'s derive the nth term formula step by step using Reena\'s salary example. Reena starts with 8000 rupees and gets 500 rupees increment each year. In year 1, her salary is 8000 rupees, which we call \'a\', the first term. In year 2, she gets 8000 plus 500, which equals 8500. Notice this is \'a plus d\'. In year 3, she gets 8000 plus 500 plus 500, which is 8000 plus 2 times 500. This follows the pattern \'a plus 2d\'. In year 4, her salary is 8000 plus 3 times 500, following \'a plus 3d\'. Do you see the pattern? For the nth year, her salary is \'a plus n minus 1 times d\'. Why n minus 1? Because in the first year, she gets zero increments, in the second year one increment, in the third year two increments, and so on. The number of increments is always one less than the year number. This gives us the general formula: a-n equals a plus n minus 1 times d.',
            'examples-scene': 'Now let\'s work through three essential types of nth term problems step by step. Example 1: Find the 10th term of the sequence 2, 7, 12, and so on. First, we identify what we know: the first term \'a\' is 2, the common difference \'d\' is 7 minus 2, which equals 5, and we want the 10th term, so \'n\' equals 10. Now we apply our formula: a-n equals a plus n minus 1 times d. Substituting our values: a-10 equals 2 plus 10 minus 1 times 5. This becomes 2 plus 9 times 5, which equals 2 plus 45, giving us 47. Example 2: Which term of the sequence 21, 18, 15, and so on equals negative 81? Here we know the first term \'a\' is 21, the common difference \'d\' is 18 minus 21, which equals negative 3, and the term value is negative 81. We need to find \'n\'. Setting up the equation: negative 81 equals 21 plus n minus 1 times negative 3. Expanding: negative 81 equals 21 minus 3n plus 3, which simplifies to negative 81 equals 24 minus 3n. Rearranging: 3n equals 24 plus 81, so 3n equals 105, therefore n equals 35. The 35th term is negative 81. Example 3: Is 301 a term of the sequence 5, 11, 17, 23, and so on? We have \'a\' equals 5, \'d\' equals 6, and we\'re testing if 301 is a term. Using our formula: 301 equals 5 plus n minus 1 times 6. This gives us 301 equals 5 plus 6n minus 6, which simplifies to 301 equals 6n minus 1. So 6n equals 302, and n equals 302 divided by 6, which is 50.33 and so on. Since n is not a whole number, 301 is NOT a term of this sequence. Remember, term positions must always be positive integers.',
            'solver-scene': 'Use this interactive solver to practice. Enter any three values and the solver will find the fourth. This helps you understand the relationship between all variables.',
            'applications-scene': 'Real-world applications include finding large terms efficiently, counting sequences with conditions, and working with terms from the end of finite sequences.'
        };

        function createNewNarrator() {
            if (currentNarrator) {
                currentNarrator.destroy();
            }
            currentNarrator = new NthTermNarrator();
            return currentNarrator;
        }

        function showScene(sceneId, buttonIndex = -1) {
            if (isAnimating) return;
            
            // Hide all scenes
            document.querySelectorAll('.content-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            // Show selected scene
            document.getElementById(sceneId).classList.add('visible');
            
            // Update active button
            if (buttonIndex >= 0) {
                document.querySelectorAll('.demo-btn').forEach((btn, index) => {
                    btn.classList.toggle('active', index === buttonIndex);
                });
            }

            // Trigger animations for the scene
            setTimeout(() => {
                animateSceneContent(sceneId);
            }, 100);

            // Narrate content
            const narrator = createNewNarrator();
            if (sceneNarrations[sceneId]) {
                narrator.speak(sceneNarrations[sceneId]);
            }

            updateAnalysis(sceneId);
        }

        function animateSceneContent(sceneId) {
            const scene = document.getElementById(sceneId);
            
            // Animate step containers
            const stepContainers = scene.querySelectorAll('.step-container');
            stepContainers.forEach((container, index) => {
                setTimeout(() => {
                    container.classList.add('visible');
                }, index * 300);
            });

            // Animate salary progression
            if (sceneId === 'derivation-scene') {
                const salaryYears = scene.querySelectorAll('.salary-year');
                salaryYears.forEach((year, index) => {
                    setTimeout(() => {
                        year.classList.add('visible');
                    }, 500 + (index * 200));
                });

                const derivationSteps = scene.querySelectorAll('.derivation-step');
                derivationSteps.forEach((step, index) => {
                    setTimeout(() => {
                        step.classList.add('visible');
                    }, 1500 + (index * 300));
                });
            }

            // Animate example boxes
            const exampleBoxes = scene.querySelectorAll('.example-box');
            exampleBoxes.forEach((box, index) => {
                setTimeout(() => {
                    box.classList.add('visible');
                }, 300 + (index * 200));
            });
        }

        function solveNthTerm() {
            const a = parseFloat(document.getElementById('input-a').value);
            const d = parseFloat(document.getElementById('input-d').value);
            const n = parseFloat(document.getElementById('input-n').value);
            const an = parseFloat(document.getElementById('input-an').value);

            const resultDiv = document.getElementById('solver-result');

            // Check if we have enough information
            const values = [a, d, n, an];
            const knownValues = values.filter(v => !isNaN(v)).length;

            if (knownValues < 3) {
                showResult('Please enter at least 3 values to solve for the 4th', 'error');
                return;
            }

            let result = '';
            const narrator = createNewNarrator();

            // Case 1: Find aₙ (given a, d, n)
            if (!isNaN(a) && !isNaN(d) && !isNaN(n) && isNaN(an)) {
                const calculatedAn = a + (n - 1) * d;
                result = `The ${n}th term is: ${calculatedAn}`;
                narrator.speak(`The ${n}th term is ${calculatedAn}`);
            }
            // Case 2: Find n (given a, d, aₙ)
            else if (!isNaN(a) && !isNaN(d) && isNaN(n) && !isNaN(an)) {
                const calculatedN = ((an - a) / d) + 1;
                if (Number.isInteger(calculatedN) && calculatedN > 0) {
                    result = `${an} is the ${calculatedN}th term`;
                    narrator.speak(`${an} is the ${calculatedN}th term`);
                } else {
                    result = `${an} is NOT a term of this AP (n = ${calculatedN.toFixed(2)})`;
                    narrator.speak(`${an} is not a term of this arithmetic progression`);
                }
            }
            // Case 3: Find a (given d, n, aₙ)
            else if (isNaN(a) && !isNaN(d) && !isNaN(n) && !isNaN(an)) {
                const calculatedA = an - (n - 1) * d;
                result = `The first term is: ${calculatedA}`;
                narrator.speak(`The first term is ${calculatedA}`);
            }
            // Case 4: Find d (given a, n, aₙ)
            else if (!isNaN(a) && isNaN(d) && !isNaN(n) && !isNaN(an)) {
                const calculatedD = (an - a) / (n - 1);
                result = `The common difference is: ${calculatedD}`;
                narrator.speak(`The common difference is ${calculatedD}`);
            }
            else {
                result = 'Please leave exactly ONE field blank to solve for it';
                narrator.speak('Please leave exactly one field blank to solve for it');
                showResult(result, 'error');
                return;
            }

            showResult(result, 'success');
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('solver-result');
            resultDiv.textContent = message;
            resultDiv.className = `result-display ${type}`;
            resultDiv.style.display = 'block';
        }

        function updateAnalysis(sceneId) {
            const analysisTexts = {
                'welcome-scene': 'Master the nth term formula through step-by-step derivation, worked examples, and real-world applications. Use the interactive solver to practice and verify your understanding.',
                'derivation-scene': 'Formula derivation shows the logical pattern: each term equals the first term plus the position minus one times the common difference.',
                'examples-scene': 'Three key problem types: finding specific terms, determining position of given values, and checking term existence in sequences.',
                'solver-scene': 'Interactive practice tool helps you understand relationships between first term, common difference, position, and term value.',
                'applications-scene': 'Real applications include efficient calculation of large terms, counting sequence elements, and working with finite sequences from either end.'
            };
            
            document.getElementById('analysis-content').textContent = analysisTexts[sceneId] || analysisTexts['welcome-scene'];
        }

        // Initialize
        window.addEventListener('load', () => {
            const narrator = createNewNarrator();
            narrator.speak('Welcome to finding the nth term of arithmetic progressions! Explore formula derivation, examples, and applications.');
            updateAnalysis('welcome-scene');
        });

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            if (currentNarrator) {
                currentNarrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    currentNarrator.stop();
                }
            }
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
        });
    </script>
</body>
</html>