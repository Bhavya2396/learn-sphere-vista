<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinate Geometry - Introduction and Basics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(126, 87, 194, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(126, 87, 194, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3.2rem;
            background: linear-gradient(45deg, #00ff88, #00bbff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Main Animation Stage */
        .animation-stage {
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            height: 600px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid rgba(0, 255, 136, 0.4);
        }

        /* Grid Background */
        .grid-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        /* Content Container inside stage */
        .stage-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        /* Animation Scenes */
        .animation-scene {
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 40px;
        }

        .animation-scene.visible {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }

        /* Welcome Scene */
        .welcome-scene {
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 20px;
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
            50% { text-shadow: 0 0 20px rgba(0, 255, 136, 0.8); }
        }

        /* Coordinate System Scene */
        .coordinate-content {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .coordinate-canvas {
            width: 100%;
            height: 100%;
        }

        /* Concept Cards */
        .concept-cards {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .concept-card {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 187, 255, 0.2));
            border: 2px solid rgba(0, 255, 136, 0.5);
            border-radius: 20px;
            padding: 30px;
            flex: 1;
            min-width: 250px;
            text-align: center;
            transform: scale(0);
            animation: cardAppear 0.5s ease forwards;
            backdrop-filter: blur(10px);
        }

        .concept-card:nth-child(1) { animation-delay: 0.2s; }
        .concept-card:nth-child(2) { animation-delay: 0.4s; }

        @keyframes cardAppear {
            to { transform: scale(1); }
        }

        .concept-title {
            font-size: 1.5rem;
            color: #00ff88;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .concept-description {
            font-size: 1.1rem;
            color: #ffffff;
            line-height: 1.6;
        }

        .highlight {
            color: #ffff00;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }

        /* Point Display */
        .point-display {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .point-list {
            font-size: 1.2rem;
            line-height: 2;
            color: #00bbff;
            font-family: 'Courier New', monospace;
        }

        /* Application Scene */
        .application-content {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .app-item {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(254, 202, 87, 0.2));
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.5s ease forwards;
        }

        .app-item:nth-child(1) { animation-delay: 0.1s; }
        .app-item:nth-child(2) { animation-delay: 0.2s; }
        .app-item:nth-child(3) { animation-delay: 0.3s; }
        .app-item:nth-child(4) { animation-delay: 0.4s; }
        .app-item:nth-child(5) { animation-delay: 0.5s; }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .app-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .app-name {
            font-size: 1.1rem;
            color: #ffd700;
            font-weight: 600;
        }

        /* Info Display */
        .info-display {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px 20px;
            text-align: center;
            font-size: 1.1rem;
            opacity: 0;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .info-display.visible {
            opacity: 1;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 2rem;
            margin-bottom: 25px;
            color: #00ff88;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #764ba2, #667eea);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.3);
            min-width: 180px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(118, 75, 162, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #00ff88, #00bbff);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(0, 255, 136, 0.4);
            backdrop-filter: blur(15px);
        }

        .analysis-title {
            font-size: 1.6rem;
            color: #00ff88;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: center;
            color: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .animation-stage {
                height: 500px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .concept-cards {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Coordinate Geometry</h1>
            <p>Introduction and Coordinate System Basics - Discover the power of locating points in a plane!</p>
        </div>

        <!-- Main Animation Stage -->
        <div class="animation-stage" id="animation-stage">
            <div class="grid-background"></div>
            
            <!-- Stage Content Container -->
            <div class="stage-content">
                <!-- Welcome Scene -->
                <div class="animation-scene visible" id="welcome-scene">
                    <div class="welcome-scene">
                        <h2 class="welcome-title">Welcome to Coordinate Geometry!</h2>
                        <p style="font-size: 1.3rem; color: #00bbff;">
                            Let's explore how to locate points on a plane<br>
                            and create amazing figures using coordinates!
                        </p>
                    </div>
                </div>

                <!-- Basics Scene -->
                <div class="animation-scene" id="basics-scene">
                    <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <canvas id="basics-canvas" style="width: 90%; max-width: 600px; height: 400px; margin: 0 auto;"></canvas>
                        <div style="margin-top: 20px; width: 100%; max-width: 600px;">
                            <div style="display: flex; gap: 20px; justify-content: center;">
                                <div class="concept-card" id="x-coord-card" style="opacity: 0; flex: 1; padding: 15px;">
                                    <div style="font-size: 1.2rem; color: #00ff88; margin-bottom: 10px;">X-Coordinate (Abscissa)</div>
                                    <div style="font-size: 0.95rem; color: #ffffff;">
                                        Distance from y-axis<br>
                                        <span class="highlight" id="x-value-display" style="font-size: 0.9rem;">Horizontal position</span>
                                    </div>
                                </div>
                                <div class="concept-card" id="y-coord-card" style="opacity: 0; flex: 1; padding: 15px;">
                                    <div style="font-size: 1.2rem; color: #00ff88; margin-bottom: 10px;">Y-Coordinate (Ordinate)</div>
                                    <div style="font-size: 0.95rem; color: #ffffff;">
                                        Distance from x-axis<br>
                                        <span class="highlight" id="y-value-display" style="font-size: 0.9rem;">Vertical position</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coordinate System Scene -->
                <div class="animation-scene" id="coordinate-scene">
                    <div class="coordinate-content">
                        <canvas id="coordinate-canvas" class="coordinate-canvas"></canvas>
                    </div>
                </div>

                <!-- Activity Scene -->
                <div class="animation-scene" id="activity-scene">
                    <div class="coordinate-content">
                        <canvas id="activity-canvas" class="coordinate-canvas"></canvas>
                    </div>
                </div>

                <!-- Applications Scene -->
                <div class="animation-scene" id="applications-scene">
                    <div class="application-content">
                        <h2 style="font-size: 2rem; color: #ffd700; margin-bottom: 30px;">
                            Real-World Applications
                        </h2>
                        <div class="app-grid">
                            <div class="app-item">
                                <div class="app-icon">⚡</div>
                                <div class="app-name">Physics</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">⚙️</div>
                                <div class="app-name">Engineering</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">🧭</div>
                                <div class="app-name">Navigation</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">📊</div>
                                <div class="app-name">Seismology</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">🎨</div>
                                <div class="app-name">Art</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equations Scene -->
                <div class="animation-scene" id="equations-scene">
                    <div style="width: 100%; max-width: 700px; text-align: center;">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 30px;">
                            Graphical Representations
                        </h2>
                        <div class="concept-cards">
                            <div class="concept-card" style="flex: 1 1 100%; max-width: none;">
                                <div class="concept-title">Linear Equation</div>
                                <div class="concept-description">
                                    <span class="highlight">ax + by + c = 0</span><br>
                                    Represents a straight line
                                </div>
                            </div>
                            <div class="concept-card" style="flex: 1 1 100%; max-width: none; margin-top: 20px;">
                                <div class="concept-title">Quadratic Equation</div>
                                <div class="concept-description">
                                    <span class="highlight">y = ax² + bx + c</span><br>
                                    Represents a parabola
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Display - Now Outside Animation Stage -->
        <div class="info-display visible" id="info-display" style="margin-top: 20px; position: relative; border-radius: 15px; background: rgba(0, 0, 0, 0.7); padding: 15px 20px;">
            Click any button below to start exploring coordinate geometry!
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="lesson-title">Choose Your Learning Path</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteLesson()">📚 Complete Lesson</button>
                <button class="demo-btn" onclick="showCoordinateSystem()">📊 Coordinate Plane</button>
                <button class="demo-btn" onclick="showBasics()">📍 Coordinate Basics</button>
                <button class="demo-btn" onclick="playActivity()">🎨 Drawing Activity</button>
                <button class="demo-btn" onclick="showApplications()">🌍 Applications</button>
                <button class="demo-btn" onclick="showEquations()">📐 Equations & Graphs</button>
                <button class="demo-btn" onclick="resetAll()">🔄 Reset</button>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis">
            <div class="analysis-title">📊 Understanding Coordinate Geometry</div>
            <div class="analysis-content" id="analysis-content">
                Coordinate geometry connects algebra and geometry, allowing us to study geometric figures using algebraic methods.
                Select a demonstration above to begin your mathematical journey!
            </div>
        </div>
    </div>

    <script>
        // Voice System
        class CoordinateNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.95, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentNarrator = null;
        let isPlaying = false;
        let currentDemoAborted = false;
        let currentTaskId = null;
        let animationTimeouts = [];
        let currentChart = null;

        // Function to stop current demo
        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentTaskId = null;
            
            // Stop and destroy narrator
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            
            // Stop speech synthesis completely
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
            
            // Clear all timeouts
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            // Hide all animation scenes
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            // Clear all canvases
            const canvases = ['coordinate-canvas', 'activity-canvas', 'basics-canvas'];
            canvases.forEach(canvasId => {
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            });
            
            // Reset concept cards
            const cards = ['x-coord-card', 'y-coord-card'];
            cards.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.style.opacity = '0';
                }
            });
            
            // Reset value displays
            const xDisplay = document.getElementById('x-value-display');
            const yDisplay = document.getElementById('y-value-display');
            if (xDisplay) xDisplay.textContent = 'Horizontal position';
            if (yDisplay) yDisplay.textContent = 'Vertical position';
            
            // Destroy any charts
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // Reset info display
            updateInfo("Click any button below to start exploring coordinate geometry!");
            
            // Reset flags
            isPlaying = false;
            currentDemoAborted = false;
            
            // Remove all active button states
            document.querySelectorAll('.demo-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function shouldContinue(taskId = null) {
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function createNewNarrator(taskId = null) {
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            currentDemoAborted = false;
            currentTaskId = taskId;
            currentNarrator = new CoordinateNarrator();
            return currentNarrator;
        }

        function switchToScene(sceneId, taskId = null) {
            if (!shouldContinue(taskId)) return;
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            const timeout = setTimeout(() => {
                if (!shouldContinue(taskId)) return;
                const scene = document.getElementById(sceneId);
                if (scene) {
                    scene.classList.add('visible');
                }
            }, 300);
            
            animationTimeouts.push(timeout);
        }

        // Draw coordinate system
        function drawCoordinateSystem(canvasId, showLabels = true) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Center point
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 20;
            
            // Draw grid (lighter)
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 0.5;
            
            for (let x = 0; x < width; x += scale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            for (let y = 0; y < height; y += scale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw main axes with bold lines
            // X-axis
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Y-axis
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // Draw axis arrows
            ctx.fillStyle = '#00ff88';
            
            // X-axis arrow (right)
            ctx.beginPath();
            ctx.moveTo(width - 5, centerY);
            ctx.lineTo(width - 20, centerY - 8);
            ctx.lineTo(width - 20, centerY + 8);
            ctx.closePath();
            ctx.fill();
            
            // Y-axis arrow (top)
            ctx.beginPath();
            ctx.moveTo(centerX, 5);
            ctx.lineTo(centerX - 8, 20);
            ctx.lineTo(centerX + 8, 20);
            ctx.closePath();
            ctx.fill();
            
            // Draw axis labels with background for better visibility
            if (showLabels) {
                // X-axis label
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(width - 45, centerY - 30, 35, 25);
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText('X', width - 35, centerY - 10);
                
                // Y-axis label
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(centerX + 10, 25, 25, 25);
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText('Y', centerX + 15, 45);
                
                // Origin label
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(centerX - 25, centerY + 10, 20, 20);
                ctx.font = 'bold 16px Arial';
                ctx.fillStyle = '#ffff00';
                ctx.fillText('O', centerX - 20, centerY + 25);
                
                // Draw tick marks and numbers
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.font = '12px Arial';
                ctx.fillStyle = '#ffffff';
                
                // X-axis numbers and ticks
                for (let i = -10; i <= 10; i++) {
                    if (i !== 0) {
                        const x = centerX + i * scale;
                        
                        if (x > 0 && x < width) {
                            // Tick mark
                            ctx.beginPath();
                            ctx.moveTo(x, centerY - 5);
                            ctx.lineTo(x, centerY + 5);
                            ctx.stroke();
                            
                            // Number with background
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                            ctx.fillRect(x - 8, centerY + 8, 16, 15);
                            ctx.fillStyle = '#ffffff';
                            ctx.fillText(i.toString(), x - 5, centerY + 20);
                        }
                    }
                }
                
                // Y-axis numbers and ticks
                for (let i = -10; i <= 10; i++) {
                    if (i !== 0) {
                        const y = centerY - i * scale;
                        
                        if (y > 0 && y < height) {
                            // Tick mark
                            ctx.beginPath();
                            ctx.moveTo(centerX - 5, y);
                            ctx.lineTo(centerX + 5, y);
                            ctx.stroke();
                            
                            // Number with background
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                            ctx.fillRect(centerX - 25, y - 7, 20, 15);
                            ctx.fillStyle = '#ffffff';
                            ctx.fillText(i.toString(), centerX - 20, y + 4);
                        }
                    }
                }
                
                // Add "x-axis" and "y-axis" text labels
                ctx.font = 'bold 14px Arial';
                ctx.fillStyle = '#00ff88';
                
                // "x-axis" text
                ctx.save();
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(width - 100, centerY + 35, 70, 20);
                ctx.fillStyle = '#00ff88';
                ctx.fillText('x-axis', width - 90, centerY + 50);
                ctx.restore();
                
                // "y-axis" text
                ctx.save();
                ctx.translate(centerX - 50, 100);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(-35, -10, 70, 20);
                ctx.fillStyle = '#00ff88';
                ctx.fillText('y-axis', -25, 5);
                ctx.restore();
            }
            
            return { ctx, centerX, centerY, scale };
        }

        // Draw the mystery picture activity with step-by-step plotting
        async function drawActivityPicture(canvasId, narrator = null) {
            const result = drawCoordinateSystem(canvasId, true);
            if (!result) return;
            
            const { ctx, centerX, centerY, scale } = result;
            
            // Define all points with labels
            const mainPoints = [
                { label: 'A', coord: [4, 8] },
                { label: 'B', coord: [3, 9] },
                { label: 'C', coord: [3, 8] },
                { label: 'D', coord: [1, 6] },
                { label: 'E', coord: [1, 5] },
                { label: 'F', coord: [3, 3] },
                { label: 'G', coord: [6, 3] },
                { label: 'H', coord: [8, 5] },
                { label: 'I', coord: [8, 6] },
                { label: 'J', coord: [6, 8] },
                { label: 'K', coord: [6, 9] },
                { label: 'L', coord: [5, 8] }
            ];
            
            const trianglePoints = [
                { group: 'Triangle 1', points: [
                    { label: 'P', coord: [3.5, 7] },
                    { label: 'Q', coord: [3, 6] },
                    { label: 'R', coord: [4, 6] }
                ]},
                { group: 'Triangle 2', points: [
                    { label: 'X', coord: [5.5, 7] },
                    { label: 'Y', coord: [5, 6] },
                    { label: 'Z', coord: [6, 6] }
                ]},
                { group: 'Triangle 3', points: [
                    { label: 'S', coord: [4, 5] },
                    { label: 'T', coord: [4.5, 4] },
                    { label: 'U', coord: [5, 5] }
                ]}
            ];
            
            const armPoints = [
                { from: 'S', to: [[0, 5], [0, 6]] },
                { from: 'U', to: [[9, 5], [9, 6]] }
            ];
            
            // Function to convert coordinates to canvas position
            const toCanvas = (x, y) => {
                return [centerX + x * scale, centerY - y * scale];
            };
            
            // Function to plot a single point with label
            const plotPoint = (label, x, y, color = '#ffff00') => {
                const [canvasX, canvasY] = toCanvas(x, y);
                
                // Draw point
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(canvasX, canvasY, 4, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw label
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(label, canvasX + 8, canvasY - 8);
                
                // Show coordinates
                ctx.font = '10px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText(`(${x}, ${y})`, canvasX + 8, canvasY + 15);
            };
            
            // Function to connect points
            const connectPoints = (points, color = '#ffff00', close = true) => {
                if (points.length < 2) return;
                
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const [startX, startY] = toCanvas(...points[0]);
                ctx.moveTo(startX, startY);
                
                for (let i = 1; i < points.length; i++) {
                    const [x, y] = toCanvas(...points[i]);
                    ctx.lineTo(x, y);
                }
                
                if (close && points.length > 2) {
                    ctx.lineTo(startX, startY);
                }
                
                ctx.stroke();
            };
            
            // Show coordinate display panel
            const showCoordinate = (label, x, y) => {
                const info = document.getElementById('info-display');
                info.textContent = `Point ${label}: x-coordinate = ${x}, y-coordinate = ${y}`;
            };
            
            // Step 1: Plot main outline points one by one
            updateInfo("Starting with the main outline points...");
            await wait(1000);
            
            for (let i = 0; i < mainPoints.length; i++) {
                const point = mainPoints[i];
                const [x, y] = point.coord;
                
                // First announce the coordinates
                showCoordinate(point.label, x, y);
                if (narrator) {
                    await narrator.speak(`Point ${point.label} has x-coordinate ${x} and y-coordinate ${y}`);
                    await wait(500);
                }
                
                // Then plot the point
                plotPoint(point.label, x, y);
                await wait(1500); // Give time to see each point
            }
            
            // Step 2: Connect main outline
            await wait(500);
            if (narrator) {
                await narrator.speak("Now let's connect points A through L and back to A to form the main shape");
            }
            updateInfo("Connecting points A → B → C → D → E → F → G → H → I → J → K → L → A");
            await wait(1000);
            
            const mainCoords = mainPoints.map(p => p.coord);
            mainCoords.push(mainPoints[0].coord); // Close the shape
            connectPoints(mainCoords, '#ffff00', false);
            await wait(2000);
            
            // Step 3: Plot and connect first triangle (P, Q, R)
            updateInfo("Now adding Triangle 1: Points P, Q, and R");
            if (narrator) {
                await narrator.speak("Let's add the first triangle with points P, Q, and R");
            }
            await wait(1000);
            
            for (const point of trianglePoints[0].points) {
                const [x, y] = point.coord;
                showCoordinate(point.label, x, y);
                if (narrator) {
                    await narrator.speak(`Point ${point.label}: x is ${x}, y is ${y}`);
                    await wait(500);
                }
                plotPoint(point.label, x, y, '#00bbff');
                await wait(1500);
            }
            
            connectPoints(trianglePoints[0].points.map(p => p.coord), '#00bbff', true);
            await wait(1500);
            
            // Step 4: Plot and connect second triangle (X, Y, Z)
            updateInfo("Adding Triangle 2: Points X, Y, and Z");
            if (narrator) {
                await narrator.speak("Now the second triangle with points X, Y, and Z");
            }
            await wait(1000);
            
            for (const point of trianglePoints[1].points) {
                const [x, y] = point.coord;
                showCoordinate(point.label, x, y);
                if (narrator) {
                    await narrator.speak(`Point ${point.label}: x is ${x}, y is ${y}`);
                    await wait(500);
                }
                plotPoint(point.label, x, y, '#00bbff');
                await wait(1500);
            }
            
            connectPoints(trianglePoints[1].points.map(p => p.coord), '#00bbff', true);
            await wait(1500);
            
            // Step 5: Plot and connect third triangle (S, T, U)
            updateInfo("Adding Triangle 3: Points S, T, and U");
            if (narrator) {
                await narrator.speak("Let's add the third triangle with points S, T, and U");
            }
            await wait(1000);
            
            for (const point of trianglePoints[2].points) {
                const [x, y] = point.coord;
                showCoordinate(point.label, x, y);
                if (narrator) {
                    await narrator.speak(`Point ${point.label}: x is ${x}, y is ${y}`);
                    await wait(500);
                }
                plotPoint(point.label, x, y, '#ff69b4');
                await wait(1500);
            }
            
            connectPoints(trianglePoints[2].points.map(p => p.coord), '#ff69b4', true);
            await wait(1500);
            
            // Step 6: Add arms
            if (narrator) {
                await narrator.speak("Finally, let's connect S to points at 0, 5 and 0, 6, and U to points at 9, 5 and 9, 6");
            }
            
            updateInfo("Adding final connections from S and U...");
            await wait(1000);
            
            // Left arm from S
            const sCoord = [4, 5];
            for (const point of armPoints[0].to) {
                const [x, y] = point;
                if (narrator) {
                    await narrator.speak(`Connecting S to point ${x}, ${y}`);
                }
                plotPoint('', x, y, '#00ff88');
                connectPoints([sCoord, point], '#00ff88', false);
                await wait(1200);
            }
            
            // Right arm from U
            const uCoord = [5, 5];
            for (const point of armPoints[1].to) {
                const [x, y] = point;
                if (narrator) {
                    await narrator.speak(`Connecting U to point ${x}, ${y}`);
                }
                plotPoint('', x, y, '#00ff88');
                connectPoints([uCoord, point], '#00ff88', false);
                await wait(1200);
            }
            
            updateInfo("Picture complete! What do you see?");
            
            // Highlight the final picture
            await wait(1500);
            ctx.shadowColor = '#ffff00';
            ctx.shadowBlur = 20;
            ctx.strokeStyle = '#ffff00';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const [startX, startY] = toCanvas(...mainPoints[0].coord);
            ctx.moveTo(startX, startY);
            for (let i = 1; i < mainPoints.length; i++) {
                const [x, y] = toCanvas(...mainPoints[i].coord);
                ctx.lineTo(x, y);
            }
            ctx.lineTo(startX, startY);
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        // Initialize
        window.addEventListener('load', () => {
            document.getElementById('welcome-scene').classList.add('visible');
            const narrator = createNewNarrator('initialization');
            narrator.speak("Welcome to Coordinate Geometry! Let's discover how to locate points on a plane and create amazing figures.");
            updateInfo("Click any button below to start exploring coordinate geometry!");
        });

        // Complete Lesson
        async function playCompleteLesson() {
            const taskId = 'complete-lesson';
            stopCurrentDemo(); // Ensure clean state
            await wait(100); // Small delay for cleanup
            isPlaying = true;
            setActiveButton(0);
            
            const narrator = createNewNarrator(taskId);
            
            updateTitle("📚 Complete Coordinate Geometry Journey");
            updateInfo("Starting complete lesson - exploring all concepts...");
            updateAnalysis("Beginning our comprehensive journey through coordinate geometry...");
            
            await narrator.speak("Welcome to the complete lesson on coordinate geometry! We'll explore how to locate points on a plane.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            // Part 1: Coordinate System
            updateInfo("Part 1: The Coordinate Plane");
            switchToScene('coordinate-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            // Draw the coordinate system with proper axes
            const canvas = document.getElementById('coordinate-canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.offsetWidth || 800;
                canvas.height = canvas.offsetHeight || 500;
                
                const width = canvas.width;
                const height = canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                const scale = 25;
                
                // Clear canvas
                ctx.fillStyle = 'rgba(22, 33, 62, 0.3)';
                ctx.fillRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 0.5;
                
                for (let x = 0; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                
                for (let y = 0; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                // Draw main axes with emphasis
                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 4;
                ctx.shadowColor = '#00ff88';
                ctx.shadowBlur = 5;
                
                // X-axis
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(width, centerY);
                ctx.stroke();
                
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, height);
                ctx.stroke();
                
                ctx.shadowBlur = 0;
                
                // Draw arrows
                ctx.fillStyle = '#00ff88';
                
                // X-axis arrow
                ctx.beginPath();
                ctx.moveTo(width - 5, centerY);
                ctx.lineTo(width - 25, centerY - 10);
                ctx.lineTo(width - 25, centerY + 10);
                ctx.closePath();
                ctx.fill();
                
                // Y-axis arrow
                ctx.beginPath();
                ctx.moveTo(centerX, 5);
                ctx.lineTo(centerX - 10, 25);
                ctx.lineTo(centerX + 10, 25);
                ctx.closePath();
                ctx.fill();
                
                // Labels
                ctx.font = 'bold 24px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText('X', width - 40, centerY - 10);
                ctx.fillText('Y', centerX + 15, 50);
                
                ctx.font = 'bold 18px Arial';
                ctx.fillStyle = '#ffff00';
                ctx.fillText('O', centerX - 20, centerY + 28);
                
                // Numbers on axes
                ctx.font = '12px Arial';
                ctx.fillStyle = '#ffffff';
                
                for (let i = -15; i <= 15; i++) {
                    if (i !== 0 && i % 2 === 0) {
                        const x = centerX + i * scale;
                        const y = centerY - i * scale;
                        
                        if (x > 10 && x < width - 10) {
                            ctx.fillText(i.toString(), x - 5, centerY + 20);
                        }
                        if (y > 10 && y < height - 10) {
                            ctx.fillText(i.toString(), centerX - 20, y + 4);
                        }
                    }
                }
            }
            
            await narrator.speak("Here's our coordinate plane! The horizontal line is the x-axis, and the vertical line is the y-axis. They meet at the origin, point zero zero.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            // Part 2: Basics
            updateInfo("Part 2: Understanding Coordinates");
            switchToScene('basics-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await demonstrateCoordinates('basics-canvas', narrator);
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            // Part 3: Activity
            updateInfo("Part 3: Drawing with Coordinates");
            switchToScene('activity-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Now let's create a picture using coordinates! We'll plot each point one by one and then connect them.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            await drawActivityPicture('activity-canvas', narrator);
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            await narrator.speak("Fantastic! By plotting and connecting coordinate points, we've created a complete picture!");
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Part 4: Applications
            updateInfo("Part 4: Real-World Applications");
            switchToScene('applications-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Coordinate geometry is used in many fields: physics for motion analysis, engineering for design, navigation for GPS, seismology for earthquakes, and even in art!");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            // Part 5: Equations
            updateInfo("Part 5: Equations and Graphs");
            switchToScene('equations-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Linear equations like ax plus by plus c equals zero create straight lines on our coordinate plane.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Quadratic equations like y equals ax squared plus bx plus c create parabolas. Coordinate geometry connects algebra and geometry!");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            updateInfo("Lesson Complete! You've mastered coordinate geometry basics!");
            updateAnalysis("Complete lesson finished! You've learned: 1) How to locate points using coordinates, 2) The coordinate plane structure, 3) Creating figures with coordinates, 4) Real-world applications, and 5) How equations create geometric shapes.");
            
            await narrator.speak("Congratulations! You now understand the basics of coordinate geometry and how it bridges algebra and geometry!");
            
            isPlaying = false;
        }

        // Function to demonstrate abscissa and ordinate
        async function demonstrateCoordinates(canvasId, narrator = null) {
            // First draw the coordinate system
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            // Set fixed dimensions for consistency
            canvas.width = canvas.offsetWidth;
            canvas.height = 400; // Fixed height for better control
            
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear and setup
            ctx.clearRect(0, 0, width, height);
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 25;
            
            // Function to redraw the coordinate system
            const redrawAxes = () => {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw grid (lighter)
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 0.5;
                
                for (let x = 0; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                
                for (let y = 0; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                // Draw main axes
                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 3;
                
                // X-axis
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(width, centerY);
                ctx.stroke();
                
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, height);
                ctx.stroke();
                
                // Draw arrows
                ctx.fillStyle = '#00ff88';
                
                // X-axis arrow
                ctx.beginPath();
                ctx.moveTo(width - 5, centerY);
                ctx.lineTo(width - 20, centerY - 8);
                ctx.lineTo(width - 20, centerY + 8);
                ctx.closePath();
                ctx.fill();
                
                // Y-axis arrow
                ctx.beginPath();
                ctx.moveTo(centerX, 5);
                ctx.lineTo(centerX - 8, 20);
                ctx.lineTo(centerX + 8, 20);
                ctx.closePath();
                ctx.fill();
                
                // Labels
                ctx.font = 'bold 18px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText('X', width - 30, centerY - 10);
                ctx.fillText('Y', centerX + 12, 25);
                
                ctx.font = 'bold 14px Arial';
                ctx.fillStyle = '#ffff00';
                ctx.fillText('O', centerX - 18, centerY + 20);
                
                // Numbers on axes
                ctx.font = '11px Arial';
                ctx.fillStyle = '#ffffff';
                
                for (let i = -10; i <= 10; i++) {
                    if (i !== 0) {
                        const x = centerX + i * scale;
                        const y = centerY - i * scale;
                        
                        if (x > 10 && x < width - 10) {
                            ctx.fillText(i.toString(), x - 5, centerY + 18);
                        }
                        if (y > 10 && y < height - 10) {
                            ctx.fillText(i.toString(), centerX - 22, y + 4);
                        }
                    }
                }
            };
            
            // Function to convert coordinates to canvas position
            const toCanvas = (x, y) => {
                return [centerX + x * scale, centerY - y * scale];
            };
            
            // Function to plot a point (similar to drawing activity)
            const plotPoint = (label, x, y, color) => {
                const [canvasX, canvasY] = toCanvas(x, y);
                
                // Draw point
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(canvasX, canvasY, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw label
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 13px Arial';
                ctx.fillText(label, canvasX + 8, canvasY - 8);
                
                // Show coordinates
                ctx.font = '11px Arial';
                ctx.fillStyle = color;
                ctx.fillText(`(${x}, ${y})`, canvasX + 8, canvasY + 18);
            };
            
            // Function to draw distance lines with animation
            const drawAbscissaLine = (x, y, color) => {
                const [pointX, pointY] = toCanvas(x, y);
                
                // Draw horizontal line from y-axis to point
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(centerX, pointY);
                ctx.lineTo(pointX, pointY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw label
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Arial';
                const midX = (centerX + pointX) / 2;
                ctx.fillText(`${Math.abs(x)} units`, midX - 18, pointY - 8);
            };
            
            const drawOrdinateLine = (x, y, color) => {
                const [pointX, pointY] = toCanvas(x, y);
                
                // Draw vertical line from x-axis to point
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(pointX, centerY);
                ctx.lineTo(pointX, pointY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw label
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Arial';
                const midY = (centerY + pointY) / 2;
                ctx.save();
                ctx.translate(pointX + 18, midY);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(`${Math.abs(y)} units`, -18, 0);
                ctx.restore();
            };
            
            // Update concept cards
            const showCard = (cardId) => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.style.opacity = '1';
                    card.style.transition = 'opacity 0.5s ease';
                }
            };
            
            const updateValueDisplay = (xValue, yValue) => {
                const xDisplay = document.getElementById('x-value-display');
                const yDisplay = document.getElementById('y-value-display');
                if (xDisplay) xDisplay.textContent = xValue;
                if (yDisplay) yDisplay.textContent = yValue;
            };
            
            // Start demonstration
            await wait(500);
            
            // Draw the initial coordinate system
            redrawAxes();
            await wait(1000);
            
            // FIRST POINT: P(5, 3)
            updateInfo("Let's plot point P at coordinates (5, 3)");
            if (narrator) {
                await narrator.speak("Let's understand abscissa and ordinate. We'll start by plotting point P with x-coordinate 5 and y-coordinate 3");
                await wait(500);
            }
            
            // Plot the first point
            plotPoint('P', 5, 3, '#ffff00');
            await wait(2000);
            
            // Explain abscissa
            updateInfo("The x-coordinate (5) is the ABSCISSA - watch the horizontal distance");
            showCard('x-coord-card');
            updateValueDisplay('5 units from y-axis', '');
            
            if (narrator) {
                await narrator.speak("The x-coordinate 5 is called the abscissa. Watch as we show the horizontal distance from the y-axis");
                await wait(500);
            }
            
            drawAbscissaLine(5, 3, '#ffff00');
            await wait(3000);
            
            // Explain ordinate
            updateInfo("The y-coordinate (3) is the ORDINATE - watch the vertical distance");
            showCard('y-coord-card');
            updateValueDisplay('5 units from y-axis', '3 units from x-axis');
            
            if (narrator) {
                await narrator.speak("The y-coordinate 3 is called the ordinate. This shows the vertical distance from the x-axis");
                await wait(500);
            }
            
            drawOrdinateLine(5, 3, '#ffff00');
            await wait(3000);
            
            // SECOND POINT: Q(-4, 6)
            updateInfo("Now let's see another example with point Q(-4, 6)");
            if (narrator) {
                await narrator.speak("Now let's plot point Q at negative 4, 6 to see how negative coordinates work");
                await wait(1000);
            }
            
            // Redraw axes to clear previous lines
            redrawAxes();
            plotPoint('P', 5, 3, '#ffff00'); // Keep first point visible
            await wait(500);
            
            // Plot second point
            plotPoint('Q', -4, 6, '#00bbff');
            await wait(2000);
            
            // Show abscissa for Q
            updateInfo("Abscissa of Q = -4 (negative means LEFT of y-axis)");
            updateValueDisplay('-4 units (left of y-axis)', '6 units (above x-axis)');
            
            if (narrator) {
                await narrator.speak("Point Q has abscissa negative 4. The negative sign means it's 4 units to the left of the y-axis");
                await wait(500);
            }
            
            drawAbscissaLine(-4, 6, '#00bbff');
            await wait(2500);
            
            // Show ordinate for Q
            updateInfo("Ordinate of Q = 6 (positive means ABOVE x-axis)");
            
            if (narrator) {
                await narrator.speak("The ordinate is 6, meaning it's 6 units above the x-axis");
                await wait(500);
            }
            
            drawOrdinateLine(-4, 6, '#00bbff');
            await wait(2500);
            
            // Final summary
            updateInfo("Remember: Abscissa = x-coordinate (horizontal), Ordinate = y-coordinate (vertical)");
            if (narrator) {
                await narrator.speak("So remember: abscissa is just another name for the x-coordinate, and ordinate is another name for the y-coordinate");
            }
        }

        // Show Basics
        async function showBasics() {
            const taskId = 'show-basics';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📍 Understanding Coordinates: Abscissa and Ordinate");
            switchToScene('basics-scene', taskId);
            updateInfo("Learning about abscissa and ordinate with visual examples...");
            
            await wait(500); // Give time for scene to load
            await demonstrateCoordinates('basics-canvas', narrator);
            
            updateAnalysis("Key concepts learned: ABSCISSA is the x-coordinate (horizontal distance from y-axis). ORDINATE is the y-coordinate (vertical distance from x-axis). Positive x goes right, negative x goes left. Positive y goes up, negative y goes down.");
            
            isPlaying = false;
        }

        // Show Coordinate System
        async function showCoordinateSystem() {
            const taskId = 'coordinate-system';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📊 The Coordinate Plane");
            switchToScene('coordinate-scene', taskId);
            updateInfo("Exploring the coordinate plane...");
            
            // Draw the coordinate system with proper axes
            const canvas = document.getElementById('coordinate-canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                const width = canvas.width;
                const height = canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                const scale = 25;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw grid (lighter)
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 0.5;
                
                for (let x = 0; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                
                for (let y = 0; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                // Draw main axes
                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 3;
                
                // X-axis
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(width, centerY);
                ctx.stroke();
                
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, height);
                ctx.stroke();
                
                // Draw arrows
                ctx.fillStyle = '#00ff88';
                
                // X-axis arrow
                ctx.beginPath();
                ctx.moveTo(width - 5, centerY);
                ctx.lineTo(width - 20, centerY - 8);
                ctx.lineTo(width - 20, centerY + 8);
                ctx.closePath();
                ctx.fill();
                
                // Y-axis arrow
                ctx.beginPath();
                ctx.moveTo(centerX, 5);
                ctx.lineTo(centerX - 8, 20);
                ctx.lineTo(centerX + 8, 20);
                ctx.closePath();
                ctx.fill();
                
                // Labels
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = '#00bbff';
                ctx.fillText('X', width - 35, centerY - 10);
                ctx.fillText('Y', centerX + 15, 25);
                
                ctx.font = 'bold 16px Arial';
                ctx.fillStyle = '#ffff00';
                ctx.fillText('O', centerX - 20, centerY + 25);
                
                // Draw axis labels
                ctx.font = 'bold 14px Arial';
                ctx.fillStyle = '#00ff88';
                
                // "x-axis" text
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(width - 100, centerY + 35, 70, 20);
                ctx.fillStyle = '#00ff88';
                ctx.fillText('x-axis', width - 90, centerY + 50);
                
                // "y-axis" text (rotated)
                ctx.save();
                ctx.translate(centerX - 50, 100);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(-35, -10, 70, 20);
                ctx.fillStyle = '#00ff88';
                ctx.fillText('y-axis', -25, 5);
                ctx.restore();
                
                // Numbers on axes with tick marks
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.font = '12px Arial';
                ctx.fillStyle = '#ffffff';
                
                for (let i = -15; i <= 15; i++) {
                    if (i !== 0) {
                        const x = centerX + i * scale;
                        const y = centerY - i * scale;
                        
                        if (x > 10 && x < width - 10) {
                            // X-axis tick
                            ctx.beginPath();
                            ctx.moveTo(x, centerY - 5);
                            ctx.lineTo(x, centerY + 5);
                            ctx.stroke();
                            
                            // X-axis number
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                            ctx.fillRect(x - 8, centerY + 8, 16, 15);
                            ctx.fillStyle = '#ffffff';
                            ctx.fillText(i.toString(), x - 5, centerY + 20);
                        }
                        
                        if (y > 10 && y < height - 10) {
                            // Y-axis tick
                            ctx.beginPath();
                            ctx.moveTo(centerX - 5, y);
                            ctx.lineTo(centerX + 5, y);
                            ctx.stroke();
                            
                            // Y-axis number
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                            ctx.fillRect(centerX - 25, y - 7, 20, 15);
                            ctx.fillStyle = '#ffffff';
                            ctx.fillText(i.toString(), centerX - 20, y + 4);
                        }
                    }
                }
                
                // Add quadrant labels after a delay
                setTimeout(() => {
                    if (!shouldContinue(taskId)) return;
                    
                    ctx.font = 'bold 16px Arial';
                    ctx.fillStyle = 'rgba(255, 215, 0, 0.7)';
                    
                    // Quadrant I
                    ctx.fillText('Quadrant I', centerX + 50, centerY - 50);
                    ctx.fillText('(+, +)', centerX + 65, centerY - 30);
                    
                    // Quadrant II
                    ctx.fillText('Quadrant II', centerX - 120, centerY - 50);
                    ctx.fillText('(-, +)', centerX - 90, centerY - 30);
                    
                    // Quadrant III
                    ctx.fillText('Quadrant III', centerX - 120, centerY + 50);
                    ctx.fillText('(-, -)', centerX - 90, centerY + 70);
                    
                    // Quadrant IV
                    ctx.fillText('Quadrant IV', centerX + 50, centerY + 50);
                    ctx.fillText('(+, -)', centerX + 65, centerY + 70);
                }, 2000);
            }
            
            await narrator.speak("The coordinate plane has two perpendicular axes. The x-axis runs horizontally, the y-axis runs vertically. They meet at the origin, point zero zero.");
            await wait(3000);
            
            if (!shouldContinue(taskId)) return;
            
            updateInfo("The plane is divided into four quadrants");
            await narrator.speak("The axes divide the plane into four quadrants, numbered counter-clockwise starting from the upper right.");
            
            updateAnalysis("The coordinate plane is the foundation of coordinate geometry. The x-axis (horizontal) and y-axis (vertical) intersect at the origin (0,0). The four quadrants help us identify the signs of coordinates: Quadrant I (+,+), Quadrant II (-,+), Quadrant III (-,-), and Quadrant IV (+,-).");
            
            isPlaying = false;
        }

        // Play Activity
        async function playActivity() {
            const taskId = 'play-activity';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("🎨 Coordinate Drawing Activity");
            switchToScene('activity-scene', taskId);
            updateInfo("Creating a picture with coordinates...");
            
            await narrator.speak("Let's create a mystery picture by plotting and connecting coordinate points! Watch carefully as we plot each point.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            await drawActivityPicture('activity-canvas', narrator);
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Amazing! We've created a picture by plotting points and connecting them. Can you see what it is? It's a happy figure with eyes and a smile!");
            
            updateAnalysis("Activity complete! By plotting points A(4,8) through L(5,8), then adding triangles PQR, XYZ, and STU, and finally connecting to create arms, we've demonstrated how coordinate geometry can create artistic figures!");
            
            isPlaying = false;
        }

        // Show Applications
        async function showApplications() {
            const taskId = 'show-applications';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("🌍 Real-World Applications");
            switchToScene('applications-scene', taskId);
            updateInfo("Discovering where coordinate geometry is used...");
            
            await narrator.speak("Coordinate geometry has amazing applications in physics, engineering, navigation, seismology, and art!");
            
            updateAnalysis("Coordinate geometry is essential in: GPS navigation systems, computer graphics and gaming, architectural design, weather mapping, and scientific data visualization.");
            
            isPlaying = false;
        }

        // Show Equations
        async function showEquations() {
            const taskId = 'show-equations';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(5);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📐 Equations and Their Graphs");
            switchToScene('equations-scene', taskId);
            updateInfo("Understanding how equations create shapes...");
            
            await narrator.speak("Linear equations create straight lines. Quadratic equations create parabolas. This is how algebra and geometry connect!");
            
            updateAnalysis("Coordinate geometry transforms algebraic equations into geometric shapes. Linear equations (ax + by + c = 0) produce lines, while quadratic equations (y = ax² + bx + c) produce curves.");
            
            isPlaying = false;
        }

        // Reset
        async function resetAll() {
            // First stop any current demo
            stopCurrentDemo();
            
            // Additional cleanup
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            
            // Cancel all speech
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
            
            // Clear all timeouts
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            // Clear all animation scenes
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            // Clear all canvases
            const canvases = ['coordinate-canvas', 'activity-canvas', 'basics-canvas'];
            canvases.forEach(canvasId => {
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        canvas.width = canvas.width; // This clears the canvas
                    }
                }
            });
            
            // Reset concept cards opacity
            const cards = ['x-coord-card', 'y-coord-card'];
            cards.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.style.opacity = '0';
                    card.style.animation = 'none';
                }
            });
            
            // Reset app items animation
            document.querySelectorAll('.app-item').forEach(item => {
                item.style.animation = 'none';
                item.style.opacity = '0';
                item.offsetHeight; // Force reflow
            });
            
            // Reset value displays
            const xDisplay = document.getElementById('x-value-display');
            const yDisplay = document.getElementById('y-value-display');
            if (xDisplay) xDisplay.textContent = 'Horizontal position';
            if (yDisplay) yDisplay.textContent = 'Vertical position';
            
            // Destroy charts
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // Wait a bit for cleanup to complete
            await wait(100);
            
            // Show welcome scene
            document.getElementById('welcome-scene').classList.add('visible');
            
            // Reset UI elements
            updateTitle("Choose Your Learning Path");
            updateInfo("Click any button below to start exploring coordinate geometry!");
            updateAnalysis("Coordinate geometry connects algebra and geometry, allowing us to study geometric figures using algebraic methods. Select a demonstration above to begin your mathematical journey!");
            
            // Remove all active button states
            setActiveButton(-1);
            
            // Reset flags
            isPlaying = false;
            currentDemoAborted = false;
            currentTaskId = null;
            
            await wait(50);
        }

        // Helper functions
        function updateTitle(title) {
            document.getElementById('lesson-title').textContent = title;
        }

        function updateInfo(text) {
            const info = document.getElementById('info-display');
            info.textContent = text;
            info.classList.add('visible');
        }

        function updateAnalysis(text) {
            document.getElementById('analysis-content').textContent = text;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => {
                const timeout = setTimeout(resolve, ms);
                animationTimeouts.push(timeout);
            });
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            if (currentNarrator) {
                currentNarrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    currentNarrator.stop();
                }
            }
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
        });
    </script>
</body>
</html>